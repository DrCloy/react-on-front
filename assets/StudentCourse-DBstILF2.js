import{j as e,r as c,R as B,y as $,z as I,B as R,D,I as L,N as O,L as z,O as X,F as Y,q as K,s as V,Q as T}from"./index-DWoieWJj.js";import{S as J,a as Z,b as ee,c as te,d as se}from"./wish-emoji-UZd_sOQ8.js";import{S as ne,a as oe,b as ce,c as ae,d as re,e as ie}from"./cry-emoji-qDPk5nUy.js";const le="_courseLayout_12s6s_1",ue="_headerContainer_12s6s_9",de="_logo_12s6s_18",_e="_TabsContainer_12s6s_24",me="_TabButton_12s6s_31",ve="_underline_12s6s_35",Ce="_layoutContainer_12s6s_45",pe="_layoutsWrapper_12s6s_53",Se="_tabLayout_12s6s_60",S={courseLayout:le,headerContainer:ue,logo:de,TabsContainer:_e,TabButton:me,underline:ve,layoutContainer:Ce,layoutsWrapper:pe,tabLayout:Se},ge="_TabContainer_15pj8_1",he="_active_15pj8_14",F={TabContainer:ge,active:he},xe=({text:s,isActive:o})=>e.jsx("div",{className:`${F.TabContainer} ${o?F.active:""}`,children:s}),ye="_cardContainer_8qy5s_1",fe="_active_8qy5s_28",je="_activeAnimation_8qy5s_1",Ne="_blocked_8qy5s_32",Te="_iconBg_8qy5s_37",ke="_icon_8qy5s_37",be="_cardContentContainer_8qy5s_52",we="_cardTitle_8qy5s_59",Ee="_cardDesc_8qy5s_64",Le="_countdownText_8qy5s_69",x={cardContainer:ye,active:fe,activeAnimation:je,blocked:Ne,iconBg:Te,icon:ke,cardContentContainer:be,cardTitle:we,cardDesc:Ee,countdownText:Le},M=(s,o,l)=>{const a=Number(localStorage.getItem(s))||0,r=a>0?a:0,[t,n]=c.useState(r>0),[u,d]=c.useState(r),C=c.useRef(null),_=c.useRef(null);c.useEffect(()=>(r>0&&(n(!0),i(r)),()=>{clearTimeout(_.current),clearInterval(C.current)}),[s,o,l]);const i=h=>{d(h),localStorage.setItem(s,h.toString()),C.current=window.setInterval(()=>{d(N=>{if(N<=1)return clearInterval(C.current),localStorage.setItem(s,"0"),0;const y=N-1;return localStorage.setItem(s,y.toString()),y})},1e3),_.current=window.setTimeout(()=>{n(!1),d(0),localStorage.setItem(s,"0")},h*1e3)};return{isBlocked:t,countdown:u,startBlock:()=>{t||setTimeout(()=>{n(!0),i(o/1e3)},l)}}},qe=({onCardClick:s,Icon:o,title:l,description:a,type:r})=>{const[t,n]=c.useState(!1),{isBlocked:u,countdown:d,startBlock:C}=M(`requests_block_${r}`,6e4,2e3);c.useEffect(()=>{n(!!u)},[u]);const _=async()=>{await s()&&(n(!0),C())};return e.jsxs("button",{className:`${x.cardContainer} ${t?x.active:""} ${u?x.blocked:""} `,onClick:_,disabled:!!t||u,children:[e.jsx("div",{className:x.iconBg,children:e.jsx(o,{className:x.icon})}),e.jsxs("div",{className:x.cardContentContainer,children:[e.jsx("div",{className:x.cardTitle,children:l}),e.jsx("div",{className:x.cardDesc,children:a})]}),u&&e.jsx("div",{className:x.countdownText,children:d})]})},Be="_pageLayout_vobj2_1",$e="_requestTitle_vobj2_11",Ie="_titleStrong_vobj2_18",Re="_requestDesc_vobj2_22",De="_cardContainer_vobj2_29",k={pageLayout:Be,requestTitle:$e,titleStrong:Ie,requestDesc:Re,cardContainer:De},Ae="_popupContainer_16fjv_1",Oe="_move_16fjv_1",Pe={popupContainer:Ae,move:Oe},P=({text:s,onClose:o})=>(c.useEffect(()=>{const l=setTimeout(o,2e3);return()=>clearTimeout(l)},[o]),e.jsx("div",{className:Pe.popupContainer,children:s})),Ue=[{type:B.kind,icon:J,title:B.title,description:B.description},{type:$.kind,icon:Z,title:$.title,description:$.description},{type:I.kind,icon:ee,title:I.title,description:I.description},{type:R.kind,icon:te,title:R.title,description:R.description},{type:D.kind,icon:se,title:D.title,description:D.description}],Fe=({setModalType:s,openModal:o})=>{const[l,a]=c.useState(!1),r=async t=>{try{return await L.sendRequest(t),a(!0),!0}catch(n){return O({error:n,setModalType:s,openModal:o}),!1}};return e.jsxs("div",{className:k.pageLayout,children:[e.jsxs("div",{className:k.requestTitle,children:[e.jsx("span",{className:k.titleStrong,children:"불편 사항"}),"이 있을 때 사용해보세요"," "]}),e.jsx("div",{className:k.requestDesc,children:"수업 중 말하기 힘들 때 이모지로 알릴 수 있어요"}),e.jsx("div",{className:k.cardContainer,children:Ue.map(t=>e.jsx(qe,{type:t.type,onCardClick:()=>r(t.type),title:t.title,description:t.description,Icon:t.icon},t.type))}),l&&e.jsx(P,{text:"라이브 피드백 전송 성공",onClose:()=>a(!1)})]})},Qe="_pageLayout_11xap_1",Me="_reactTitle_11xap_11",He="_titleStrong_11xap_18",We="_reactDesc_11xap_22",Ge="_cardContainer_11xap_29",b={pageLayout:Qe,reactTitle:Me,titleStrong:He,reactDesc:We,cardContainer:Ge},ze="_cardContainer_12k0d_1",Xe="_active_12k0d_37",Ye="_activeAnimation_12k0d_1",Ke="_blocked_12k0d_41",Ve="_icon_12k0d_46",Je="_countdownText_12k0d_51",w={cardContainer:ze,active:Xe,activeAnimation:Ye,blocked:Ke,icon:Ve,countdownText:Je},Ze=({type:s,Icon:o,onCardClick:l})=>{const[a,r]=c.useState(!1),{isBlocked:t,countdown:n,startBlock:u}=M(`reactions_block_${s}`,1e4,2e3);c.useEffect(()=>{r(!!t)},[t]);const d=async()=>{await l()&&(r(!0),u())};return e.jsxs("button",{className:`${w.cardContainer} ${a?w.active:""} ${t?w.blocked:""} `,disabled:!!a||t,onClick:d,children:[e.jsx(o,{className:w.icon}),t&&e.jsx("div",{className:w.countdownText,children:n})]})},et=[{type:"OKAY",icon:ne},{type:"CLAP",icon:oe},{type:"THUMBS_UP",icon:ce},{type:"SURPRISED",icon:ae},{type:"CRYING",icon:re},{type:"HEART_EYES",icon:ie}],tt=({setModalType:s,openModal:o})=>{const[l,a]=c.useState(!1),r=async t=>{try{return await L.sendReaction(t),a(!0),!0}catch(n){return n instanceof z?n.errorCode==="COURSE_NOT_FOUND"?(s("notFound"),o()):n.errorCode==="COURSE_NOT_ACTIVE"&&(s("notStart"),o()):n instanceof X?(s("server"),o()):(s("unknown"),o()),!1}};return e.jsxs("div",{className:b.pageLayout,children:[e.jsxs("div",{className:b.reactTitle,children:[e.jsx("span",{className:b.titleStrong,children:"간단한 반응"}),"을 남기며 소통해보세요"]}),e.jsx("div",{className:b.reactDesc,children:"이모지로 가볍게 감정을 표현할 수 있어요"}),e.jsx("div",{className:b.cardContainer,children:et.map(t=>e.jsx(Ze,{type:t.type,Icon:t.icon,onCardClick:()=>r(t.type)},t.type))}),l&&e.jsx(P,{text:"라이브 이모지 전송 성공",onClose:()=>a(!1)})]})},st="_pageLayout_1gvu2_1",nt="_contentContainer_1gvu2_11",ot="_questionTitle_1gvu2_17",ct="_titleStrong_1gvu2_24",at="_questionDesc_1gvu2_28",rt="_questionLayout_1gvu2_35",it="_questionContainer_1gvu2_45",lt="_cardContainer_1gvu2_78",j={pageLayout:st,contentContainer:nt,questionTitle:ot,titleStrong:ct,questionDesc:at,questionLayout:rt,questionContainer:it,cardContainer:lt},ut="_formContainer_1dppo_1",dt="_textareaBox_1dppo_12",_t="_formFooter_1dppo_29",mt="_countText_1dppo_35",vt="_sendButton_1dppo_40",E={formContainer:ut,textareaBox:dt,formFooter:_t,countText:mt,sendButton:vt},Q=({inputValue:s,setInputValue:o,onInputSubmit:l,placeholder:a})=>{const t=n=>{const u=n.target.value;u.length<=200&&o(u)};return e.jsxs("form",{className:E.formContainer,onSubmit:l,children:[e.jsx("textarea",{className:E.textareaBox,placeholder:a,value:s,onChange:n=>t(n)}),e.jsxs("div",{className:E.formFooter,children:[e.jsxs("div",{className:E.countText,children:[s.length,"/",200]}),e.jsx("button",{type:"submit",className:E.sendButton,disabled:s.trim().length===0,children:"전송"})]})]})},Ct="_messageContainer_75yv5_1",pt="_active_75yv5_20",St="_moveOut_75yv5_1",gt="_messageBox_75yv5_24",ht="_messageContent_75yv5_33",xt="_buttonSvg_75yv5_41",yt="_checkButton_75yv5_53",ft="_checkSvg_75yv5_58",jt="_time_75yv5_64",f={messageContainer:Ct,active:pt,moveOut:St,messageBox:gt,messageContent:ht,buttonSvg:xt,checkButton:yt,checkSvg:ft,time:jt},Nt=s=>c.createElement("svg",{width:18,height:14,viewBox:"0 0 18 14",fill:"none",xmlns:"http://www.w3.org/2000/svg",...s},c.createElement("path",{d:"M17 1.52344L6 12.5234L1 7.52344",stroke:"currentColor",strokeWidth:1.66667,strokeLinecap:"round",strokeLinejoin:"round"})),Tt=({message:s,time:o,onMessageClick:l,deleteQuestion:a})=>{const[r,t]=c.useState(!1),n=()=>{l(),t(!0)};return e.jsxs("div",{className:`${f.messageContainer}  ${r?f.active:""}`,onAnimationEnd:a,children:[e.jsxs("div",{className:f.messageBox,children:[e.jsx("div",{className:f.messageContent,children:s}),e.jsx("button",{onClick:n,className:`${f.buttonSvg} ${r?f.checkButton:""}`,disabled:r,children:e.jsx(Nt,{className:f.checkSvg})})]}),e.jsx("div",{className:f.time,children:o})]})},kt=({setModalType:s,openModal:o,setQuestions:l,questions:a})=>{const[r,t]=c.useState(!1),[n,u]=c.useState(""),d=async i=>{if(i.preventDefault(),n.trim().length>0)try{const{id:g,createdAt:h,content:N}=await L.sendQuestion(n),y={id:g,content:N,createdAt:h};l(m=>[...m,y]),u(""),t(!0)}catch(g){O({error:g,setModalType:s,openModal:o})}},C=async i=>{try{await L.checkQuestionByStudent(i)}catch(g){console.log(g)}},_=i=>{l(g=>g.filter(h=>h.id!==i))};return e.jsx(e.Fragment,{children:a.length===0?e.jsxs("div",{className:j.pageLayout,children:[e.jsxs("div",{className:j.contentContainer,children:[e.jsxs("div",{className:j.questionTitle,children:["언제든 편리하게",e.jsx("span",{className:j.titleStrong,children:" 익명"}),"으로 질문하세요"]}),e.jsx("div",{className:j.questionDesc,children:"답 해주시지 않는다면 피드백 이모지를 활용해보세요"})]}),e.jsx(Q,{inputValue:n,setInputValue:u,onInputSubmit:d,placeholder:"완전 익명으로 안심하고 질문해보세요"})]}):e.jsxs("div",{className:j.questionLayout,children:[e.jsx("div",{className:j.questionContainer,children:a.map(i=>e.jsx(Tt,{deleteQuestion:()=>_(i.id),message:i.content,time:i.createdAt,onMessageClick:()=>C(i.id)},i.id))}),e.jsx(Q,{inputValue:n,setInputValue:u,onInputSubmit:d,placeholder:"완전 익명으로 안심하고 질문해보세요"}),r&&e.jsx(P,{text:"전송 성공! 답변을 듣고 난 후 질문 체크 잊지마세요!",onClose:()=>t(!1)})]})})},A=[{key:"request",label:"요청하기"},{key:"react",label:"반응하기"},{key:"question",label:"질문하기"}],bt="https://api.softeer-reacton.shop",qt=()=>{const s=Y(),[o,l]=c.useState(A[0].key),[a,r]=c.useState({left:0,width:0}),[t,n]=c.useState([]),[u,d]=c.useState(null),C=c.useRef({}),_=c.useRef(null),{openModal:i,closeModal:g,Modal:h}=K();c.useEffect(()=>{async function v(){try{const p=await L.getQuestions();n(p)}catch(p){O({error:p,setModalType:d,openModal:i})}}v()},[]),c.useEffect(()=>((()=>{_.current&&_.current.close();const p=new EventSource(`${bt}/sse/connection/student`,{withCredentials:!0});p.onmessage=q=>{const U=JSON.parse(q.data);switch(U.messageType){case"QUESTION_CHECK":n(W=>W.filter(G=>G.id!==U.data.id));break;case"COURSE_CLOSED":d("closedCourse"),i();break}},p.onerror=()=>{p.readyState!==EventSource.CONNECTING&&(p.close(),_.current=null,d("sse"),i())},_.current=p})(),()=>{_.current&&(_.current.close(),_.current.onmessage=null,_.current.onerror=null)}),[]),c.useEffect(()=>(y(),window.addEventListener("resize",y),()=>{window.removeEventListener("resize",y)}),[o]);const N=A.findIndex(v=>v.key===o),y=()=>{const v=C.current[o];v&&r({left:v.offsetLeft,width:v.offsetWidth})},m=()=>{g(),d(null),s("/student")},H=()=>{switch(u){case"notFound":return T("notFound",m,m);case"notStart":return T("notStart",m,m);case"server":return T("server",m,m);case"closedCourse":return T("closedCourse",m,m);case"sse":return T("sse",m,m);default:return T("unknown",m,m)}};return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:S.courseLayout,children:[e.jsxs("header",{className:S.headerContainer,children:[e.jsx(V,{className:S.logo,onClick:()=>s("/student")}),e.jsxs("div",{className:S.TabsContainer,children:[A.map(({key:v,label:p})=>e.jsx("button",{ref:q=>C.current[v]=q,className:S.TabButton,onClick:()=>{l(v)},children:e.jsx(xe,{text:p,isActive:o===v})},v)),e.jsx("div",{className:S.underline,style:{left:a.left,width:a.width}})]})]}),e.jsx("div",{className:S.layoutContainer,children:e.jsxs("div",{className:S.layoutsWrapper,style:{transform:`translateX(-${N*33.33}%)`},children:[e.jsx("div",{className:S.tabLayout,children:e.jsx(Fe,{setModalType:d,openModal:i})}),e.jsx("div",{className:S.tabLayout,children:e.jsx(tt,{setModalType:d,openModal:i})}),e.jsx("div",{className:S.tabLayout,children:e.jsx(kt,{questions:t,setQuestions:n,setModalType:d,openModal:i})})]})})]}),e.jsx(h,{children:H()})]})};export{qt as default};
